# CloudImgs - ç®€å•ã€æ–¹ä¾¿çš„å¼€æºå›¾åºŠé¡¹ç›®ï¼Œæ”¯æŒ NAS éƒ¨ç½²

## è½¯ä»¶é¢„è§ˆ

| æ¡Œé¢ç«¯                                               | ç§»åŠ¨ç«¯                                                     |
| ---------------------------------------------------- | ---------------------------------------------------------- |
| ![CloudImgs æ¡Œé¢ç«¯é¢„è§ˆ](client/public/cloudimgs.png) | ![CloudImgs ç§»åŠ¨ç«¯é¢„è§ˆ](client/public/cloudimgsmobile.png) |

ä¸€ä¸ªç®€å•ã€æ–¹ä¾¿çš„å¼€æºå›¾åºŠé¡¹ç›®ï¼Œä¸€é”® NAS éƒ¨ç½²ï¼Œæ”¯æŒå›¾ç‰‡ä¸Šä¼ ã€ç®¡ç†ã€é¢„è§ˆå’Œåˆ†äº«ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½

- **å›¾ç‰‡ä¸Šä¼ **: æ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼Œå¤šç§å›¾ç‰‡æ ¼å¼
- **å›¾ç‰‡ç®¡ç†**: æµè§ˆã€é¢„è§ˆã€ä¸‹è½½ã€åˆ é™¤å›¾ç‰‡
- **å›¾ç‰‡åˆ†äº«**: ä¸€é”®å¤åˆ¶å›¾ç‰‡é“¾æ¥
- **ç»Ÿè®¡ä¿¡æ¯**: å®æ—¶æ˜¾ç¤ºå­˜å‚¨ä½¿ç”¨æƒ…å†µ

### ğŸ” å¯†ç ä¿æŠ¤

- **è®¿é—®æ§åˆ¶**: å¯è®¾ç½®è®¿é—®å¯†ç ï¼Œä¿æŠ¤å›¾ç‰‡å®‰å…¨
- **ç™»å½•ç•Œé¢**: ç¾è§‚çš„ç™»å½•ç•Œé¢ï¼Œæ”¯æŒå¯†ç éªŒè¯
- **ä¼šè¯ç®¡ç†**: ç™»å½•çŠ¶æ€è‡ªåŠ¨ä¿å­˜ï¼Œæ”¯æŒé€€å‡ºç™»å½•
- **API ä¿æŠ¤**: æ‰€æœ‰ç®¡ç†æ¥å£éƒ½éœ€è¦å¯†ç éªŒè¯
- **å¯é€‰å¯ç”¨**: é€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶æ˜¯å¦å¯ç”¨å¯†ç ä¿æŠ¤

### ğŸ“ å­ç›®å½•ç®¡ç†

- **æ™ºèƒ½ç›®å½•é€‰æ‹©**: å¯é€‰æ‹©ç°æœ‰ç›®å½•æˆ–è¾“å…¥æ–°ç›®å½•
- **ç›®å½•ä¿¡æ¯å±•ç¤º**: åœ¨å›¾ç‰‡ç®¡ç†é¡µé¢æ˜¾ç¤ºå½“å‰ç›®å½•ä¿¡æ¯
- **ç›®å½•ç»Ÿè®¡**: æ”¯æŒæŒ‰ç›®å½•ç»Ÿè®¡å›¾ç‰‡æ•°é‡å’Œå­˜å‚¨å¤§å°

### ğŸ”§ SVG å·¥å…·

- **SVG è½¬ PNG**: è¾“å…¥ SVG ä»£ç ï¼Œå®æ—¶è½¬æ¢ä¸º PNG å›¾ç‰‡
- **åœ¨çº¿é¢„è§ˆ**: è½¬æ¢åç«‹å³é¢„è§ˆ PNG æ•ˆæœ
- **ä¸€é”®ä¸Šä¼ **: è½¬æ¢å®Œæˆåç›´æ¥ä¸Šä¼ åˆ°å›¾åºŠ
- **æ‰¹é‡ä¸‹è½½**: æ”¯æŒä¸‹è½½è½¬æ¢åçš„ PNG å›¾ç‰‡
- **ç¤ºä¾‹ä»£ç **: æä¾›å¸¸ç”¨ SVG ç¤ºä¾‹ä»£ç 
- **è‡ªå®šä¹‰æ–‡ä»¶å**: æ”¯æŒè‡ªå®šä¹‰ä¸Šä¼ å’Œä¸‹è½½çš„æ–‡ä»¶å
- **è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶å**: åŸºäºæ—¶é—´æˆ³è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶å

### ğŸ—œï¸ å›¾ç‰‡å‹ç¼©å·¥å…·

- **Canvas å‹ç¼©**: åŸºäº Canvas API è¿›è¡Œé«˜è´¨é‡å›¾ç‰‡å‹ç¼©
- **å°ºå¯¸è°ƒæ•´**: æ”¯æŒè®¾ç½®å‹ç¼©åçš„å®½åº¦å’Œé«˜åº¦
- **å®½é«˜æ¯”é”å®š**: è‡ªåŠ¨ä¿æŒåŸå§‹å›¾ç‰‡çš„å®½é«˜æ¯”ä¾‹
- **è´¨é‡è°ƒèŠ‚**: 1-100% å¯è°ƒèŠ‚å‹ç¼©è´¨é‡
- **å®æ—¶é¢„è§ˆ**: å‹ç¼©åç«‹å³é¢„è§ˆæ•ˆæœ
- **å‹ç¼©ä¿¡æ¯**: æ˜¾ç¤ºåŸå§‹å¤§å°ã€å‹ç¼©åå¤§å°å’Œå‹ç¼©ç‡
- **ä¸€é”®ä¸Šä¼ **: å‹ç¼©å®Œæˆåç›´æ¥ä¸Šä¼ åˆ°å›¾åºŠ
- **æœ¬åœ°ä¸‹è½½**: æ”¯æŒä¸‹è½½å‹ç¼©åçš„å›¾ç‰‡
- **æ™ºèƒ½é»˜è®¤**: æ ¹æ®åŸå§‹å›¾ç‰‡è‡ªåŠ¨è®¡ç®—åˆé€‚çš„å‹ç¼©å°ºå¯¸

### ğŸŒ“ ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½

- **å¤šä¸»é¢˜æ”¯æŒ**: æ”¯æŒæµ…è‰²ä¸»é¢˜å’Œæš—è‰²ä¸»é¢˜
- **è‡ªåŠ¨æ¨¡å¼**: æ ¹æ®ç³»ç»Ÿæ—¶é—´è‡ªåŠ¨åˆ‡æ¢ä¸»é¢˜ï¼ˆ6:00-18:00 æµ…è‰²ï¼Œ18:00-6:00 æš—è‰²ï¼‰
- **æ‰‹åŠ¨åˆ‡æ¢**: æ”¯æŒæ‰‹åŠ¨é€‰æ‹©æµ…è‰²ã€æš—è‰²æˆ–è‡ªåŠ¨æ¨¡å¼
- **ä¸»é¢˜æŒä¹…åŒ–**: ä¸»é¢˜è®¾ç½®è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
- **å®æ—¶åˆ‡æ¢**: ä¸»é¢˜åˆ‡æ¢ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€åˆ·æ–°é¡µé¢
- **å…¨é¢é€‚é…**: æ‰€æœ‰é¡µé¢å’Œç»„ä»¶éƒ½å®Œç¾é€‚é…ä¸¤ç§ä¸»é¢˜
- **ä¼˜é›…åŠ¨ç”»**: ä¸»é¢˜åˆ‡æ¢æ—¶æœ‰å¹³æ»‘çš„è¿‡æ¸¡æ•ˆæœ

### ğŸ“± ç§»åŠ¨ç«¯é€‚é…

- **å“åº”å¼å¸ƒå±€**: åŸºäº Ant Design Grid ç³»ç»Ÿçš„å®Œç¾å“åº”å¼è®¾è®¡
- **ç§»åŠ¨ç«¯å¯¼èˆª**: ç§»åŠ¨ç«¯ä½¿ç”¨æŠ½å±‰å¼èœå•ï¼Œæä¾›æ›´å¥½çš„è§¦æ‘¸ä½“éªŒ
- **è‡ªé€‚åº”å¸ƒå±€**: æ ¹æ®å±å¹•å°ºå¯¸è‡ªåŠ¨è°ƒæ•´å¸ƒå±€å’Œç»„ä»¶å¤§å°
- **è§¦æ‘¸ä¼˜åŒ–**: æŒ‰é’®å’Œäº¤äº’å…ƒç´ é’ˆå¯¹ç§»åŠ¨ç«¯è§¦æ‘¸æ“ä½œè¿›è¡Œä¼˜åŒ–
- **å›¾ç‰‡ç®¡ç†**: ç§»åŠ¨ç«¯å›¾ç‰‡ç½‘æ ¼è‡ªåŠ¨è°ƒæ•´ä¸ºå•åˆ—å¸ƒå±€
- **API æ–‡æ¡£**: ç§»åŠ¨ç«¯ä»£ç ç¤ºä¾‹å’Œæ–‡æ¡£è‡ªåŠ¨é€‚é…å°å±å¹•
- **ä¸»é¢˜é€‚é…**: ç§»åŠ¨ç«¯å®Œç¾æ”¯æŒæµ…è‰²å’Œæš—è‰²ä¸»é¢˜åˆ‡æ¢

## å¿«é€Ÿå¼€å§‹

### å¿«é€Ÿéƒ¨ç½² - docker-compose.yml

```yaml
version: "3.8"

services:
  cloudimgs:
    image: qazzxxx/cloudimgs:latest
    ports:
      - "3001:3001"
    volumes:
      - ./uploads:/app/uploads:rw # ä¸Šä¼ ç›®å½•é…ç½®ï¼Œæ˜ç¡®è¯»å†™æƒé™
    restart: unless-stopped
    container_name: cloudimgs-app
    # ä½¿ç”¨ root ç”¨æˆ·è¿è¡Œä»¥è§£å†³æƒé™é—®é¢˜
    user: "root"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - STORAGE_PATH=/app/uploads
      # å¯†ç ä¿æŠ¤é…ç½®ï¼ˆå¯é€‰ï¼‰
      # - PASSWORD=your_secure_password_here
```

### å¯†ç ä¿æŠ¤é…ç½®

å¦‚éœ€å¯ç”¨å¯†ç ä¿æŠ¤ï¼Œè¯·åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® `PASSWORD`ï¼š

```bash
environment:
  - PASSWORD=your_secure_password_here
```

**æ³¨æ„äº‹é¡¹ï¼š**

- è®¾ç½® `PASSWORD` ç¯å¢ƒå˜é‡åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨å¯ç”¨å¯†ç ä¿æŠ¤
- æœªè®¾ç½® `PASSWORD` æ—¶ï¼Œç³»ç»Ÿæ— éœ€å¯†ç å³å¯è®¿é—®
- å¯†ç éªŒè¯æˆåŠŸåï¼Œç™»å½•çŠ¶æ€ä¼šä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­

## API æ¥å£æ–‡æ¡£

### ğŸ“¤ å›¾ç‰‡ä¸Šä¼ 

**æ¥å£åœ°å€ï¼š** `POST /api/upload`

**è®¤è¯è¦æ±‚ï¼š** å¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼Œéœ€è¦æä¾›è®¿é—®å¯†ç 

| å‚æ•°å   | ç±»å‹   | å¿…å¡« | æè¿°                           |
| -------- | ------ | ---- | ------------------------------ |
| image    | file   | æ˜¯   | è¦ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶               |
| dir      | string | å¦   | å­˜å‚¨ç›®å½•è·¯å¾„ï¼ˆæ”¯æŒå¤šå±‚ç›®å½•ï¼‰   |
| password | string | æ˜¯\* | è®¿é—®å¯†ç ï¼ˆå¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼‰ |

**æ”¯æŒæ ¼å¼ï¼š** JPG, PNG, GIF, WebP, BMP, SVG  
**æ–‡ä»¶å¤§å°é™åˆ¶ï¼š** æœ€å¤§ 10MB

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",
  "data": {
    "filename": "image.jpg",
    "originalName": "åŸå§‹æ–‡ä»¶å.jpg",
    "size": 1024000,
    "mimetype": "image/jpeg",
    "uploadTime": "2024-01-01T12:00:00.000Z",
    "url": "/api/images/image.jpg",
    "relPath": "image.jpg"
  }
}
```

### ğŸ“‹ è·å–å›¾ç‰‡åˆ—è¡¨

**æ¥å£åœ°å€ï¼š** `GET /api/images`

**è®¤è¯è¦æ±‚ï¼š** å¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼Œéœ€è¦æä¾›è®¿é—®å¯†ç 

| å‚æ•°å   | ç±»å‹   | å¿…å¡« | æè¿°                           |
| -------- | ------ | ---- | ------------------------------ |
| dir      | string | å¦   | æŒ‡å®šç›®å½•è·¯å¾„ï¼ˆæ”¯æŒå¤šå±‚ç›®å½•ï¼‰   |
| password | string | æ˜¯\* | è®¿é—®å¯†ç ï¼ˆå¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": [
    {
      "filename": "image.jpg",
      "relPath": "image.jpg",
      "size": 1024000,
      "uploadTime": "2024-01-01T12:00:00.000Z",
      "url": "/api/images/image.jpg"
    }
  ]
}
```

### ğŸ² è·å–éšæœºå›¾ç‰‡

**æ¥å£åœ°å€ï¼š** `GET /api/random`

**è®¤è¯è¦æ±‚ï¼š** å¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼Œéœ€è¦æä¾›è®¿é—®å¯†ç 

| å‚æ•°å   | ç±»å‹   | å¿…å¡« | æè¿°                                            |
| -------- | ------ | ---- | ----------------------------------------------- |
| dir      | string | å¦   | æŒ‡å®šç›®å½•è·¯å¾„ï¼ˆæ”¯æŒå¤šå±‚ç›®å½•ï¼‰                    |
| format   | string | å¦   | è¿”å›æ ¼å¼ï¼Œjson è¿”å› JSON æ•°æ®ï¼Œå¦åˆ™ç›´æ¥è¿”å›å›¾ç‰‡ |
| password | string | æ˜¯\* | è®¿é—®å¯†ç ï¼ˆå¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼‰                  |

**å“åº”æ ¼å¼ï¼š**

- å½“ `format=json` æ—¶è¿”å› JSON æ•°æ®
- å¦åˆ™ç›´æ¥è¿”å›å›¾ç‰‡æ–‡ä»¶

### ğŸ“ è·å–ç›®å½•åˆ—è¡¨

**æ¥å£åœ°å€ï¼š** `GET /api/directories`

**è®¤è¯è¦æ±‚ï¼š** å¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼Œéœ€è¦æä¾›è®¿é—®å¯†ç 

| å‚æ•°å   | ç±»å‹   | å¿…å¡« | æè¿°                           |
| -------- | ------ | ---- | ------------------------------ |
| dir      | string | å¦   | æŒ‡å®šç›®å½•è·¯å¾„ï¼ˆæ”¯æŒå¤šå±‚ç›®å½•ï¼‰   |
| password | string | æ˜¯\* | è®¿é—®å¯†ç ï¼ˆå¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": [
    {
      "name": "2024",
      "path": "2024",
      "fullPath": "/app/uploads/2024"
    }
  ]
}
```

### ğŸ“Š è·å–ç»Ÿè®¡ä¿¡æ¯

**æ¥å£åœ°å€ï¼š** `GET /api/stats`

**è®¤è¯è¦æ±‚ï¼š** å¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼Œéœ€è¦æä¾›è®¿é—®å¯†ç 

| å‚æ•°å   | ç±»å‹   | å¿…å¡« | æè¿°                           |
| -------- | ------ | ---- | ------------------------------ |
| dir      | string | å¦   | æŒ‡å®šç›®å½•è·¯å¾„ï¼ˆæ”¯æŒå¤šå±‚ç›®å½•ï¼‰   |
| password | string | æ˜¯\* | è®¿é—®å¯†ç ï¼ˆå¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "totalImages": 100,
    "totalSize": 104857600,
    "storagePath": "/app/uploads"
  }
}
```

### ğŸ—‘ï¸ åˆ é™¤å›¾ç‰‡

**æ¥å£åœ°å€ï¼š** `DELETE /api/images/{path}`

**è®¤è¯è¦æ±‚ï¼š** å¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼Œéœ€è¦æä¾›è®¿é—®å¯†ç 

| å‚æ•°å   | ç±»å‹   | å¿…å¡« | æè¿°                           |
| -------- | ------ | ---- | ------------------------------ |
| path     | string | æ˜¯   | å›¾ç‰‡è·¯å¾„ï¼ˆURL è·¯å¾„å‚æ•°ï¼‰       |
| password | string | æ˜¯\* | è®¿é—®å¯†ç ï¼ˆå¦‚æœå¯ç”¨äº†å¯†ç ä¿æŠ¤ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true
}
```

### ğŸ“– è·å–æŒ‡å®šå›¾ç‰‡

**æ¥å£åœ°å€ï¼š** `GET /api/images/{path}`

**è®¤è¯è¦æ±‚ï¼š** æ— éœ€è®¤è¯

| å‚æ•°å | ç±»å‹   | å¿…å¡« | æè¿°                     |
| ------ | ------ | ---- | ------------------------ |
| path   | string | æ˜¯   | å›¾ç‰‡è·¯å¾„ï¼ˆURL è·¯å¾„å‚æ•°ï¼‰ |

**å“åº”æ ¼å¼ï¼š** ç›´æ¥è¿”å›å›¾ç‰‡æ–‡ä»¶

## ä½¿ç”¨ç¤ºä¾‹

### 1. ä¸Šä¼ å›¾ç‰‡ï¼ˆä½¿ç”¨ curlï¼‰

```bash
# ä¸Šä¼ åˆ°æ ¹ç›®å½•ï¼ˆæ— å¯†ç ä¿æŠ¤ï¼‰
curl -X POST http://localhost:3001/api/upload \
  -F "image=@/path/to/your/image.jpg"

# ä¸Šä¼ åˆ°æ ¹ç›®å½•ï¼ˆæœ‰å¯†ç ä¿æŠ¤ï¼‰
curl -X POST http://localhost:3001/api/upload \
  -H "X-Access-Password: your_password" \
  -F "image=@/path/to/your/image.jpg"

# ä¸Šä¼ åˆ°æŒ‡å®šå­ç›®å½•ï¼ˆæœ‰å¯†ç ä¿æŠ¤ï¼‰
curl -X POST "http://localhost:3001/api/upload?dir=2024/06/10" \
  -H "X-Access-Password: your_password" \
  -F "image=@/path/to/your/image.jpg"
```

### 2. è·å–å›¾ç‰‡åˆ—è¡¨ï¼ˆä½¿ç”¨ fetchï¼‰

```javascript
// è·å–æ ¹ç›®å½•æ‰€æœ‰å›¾ç‰‡ï¼ˆæ— å¯†ç ä¿æŠ¤ï¼‰
fetch("/api/images")
  .then((response) => response.json())
  .then((data) => console.log(data));

// è·å–æ ¹ç›®å½•æ‰€æœ‰å›¾ç‰‡ï¼ˆæœ‰å¯†ç ä¿æŠ¤ï¼‰
fetch("/api/images", {
  headers: {
    "X-Access-Password": "your_password",
  },
})
  .then((response) => response.json())
  .then((data) => console.log(data));

// è·å–æŒ‡å®šç›®å½•å›¾ç‰‡ï¼ˆæœ‰å¯†ç ä¿æŠ¤ï¼‰
fetch("/api/images?dir=2024/06/10", {
  headers: {
    "X-Access-Password": "your_password",
  },
})
  .then((response) => response.json())
  .then((data) => console.log(data));
```

### 3. è·å–éšæœºå›¾ç‰‡

```javascript
// ç›´æ¥è·å–å›¾ç‰‡æ–‡ä»¶
<img src="/api/random?password=your_password" alt="éšæœºå›¾ç‰‡" />;

// è·å–JSONæ ¼å¼çš„å›¾ç‰‡ä¿¡æ¯
fetch("/api/random?format=json&password=your_password")
  .then((response) => response.json())
  .then((data) => console.log(data));
```

### 4. åˆ é™¤å›¾ç‰‡

```bash
# åˆ é™¤å›¾ç‰‡ï¼ˆæ— å¯†ç ä¿æŠ¤ï¼‰
curl -X DELETE http://localhost:3001/api/images/image.jpg

# åˆ é™¤å›¾ç‰‡ï¼ˆæœ‰å¯†ç ä¿æŠ¤ï¼‰
curl -X DELETE -H "X-Access-Password: your_password" http://localhost:3001/api/images/image.jpg
```
